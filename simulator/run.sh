#!/bin/bash

trap cleanup INT

mkfifo ttyUSB0

echo "Created fake device ttyUSB0"
echo "You can start listening now"
(
while : ;
do
    cat - << EOF
/ISK5\2M550T-1012

1-3:0.2.8(50)
0-0:1.0.0($(date +%y%m%d%H%M%S)S)
0-0:96.1.1(4531323334353637383930313233343536)
1-0:1.8.1(003432.827*kWh)
1-0:1.8.2(003224.632*kWh)
1-0:2.8.1(000000.000*kWh)
1-0:2.8.2(000000.000*kWh)
0-0:96.14.0(0001)
1-0:1.7.0(00.378*kW)
1-0:2.7.0(00.000*kW)
0-0:96.7.21(00005)
0-0:96.7.9(00003)
1-0:99.97.0(1)(0-0:96.7.19)(180417201458S)(0000000236*s)
1-0:32.32.0(00001)
1-0:52.32.0(00001)
1-0:72.32.0(00001)
1-0:32.36.0(00001)
1-0:52.36.0(00001)
1-0:72.36.0(00001)
0-0:96.13.0(494D504F5254414E543A20546869732069732046414B45206461746120616E642074686520636865636B73756D20697320494E434F52524543542121)
1-0:32.7.0(237.1*V)
1-0:52.7.0(235.1*V)
1-0:72.7.0(236.1*V)
1-0:31.7.0(000*A)
1-0:51.7.0(000*A)
1-0:71.7.0(002*A)
1-0:21.7.0(00.045*kW)
1-0:41.7.0(00.010*kW)
1-0:61.7.0(00.322*kW)
1-0:22.7.0(00.000*kW)
1-0:42.7.0(00.000*kW)
1-0:62.7.0(00.000*kW)
!D4BA
EOF
    echo -n '.' 1>&2
    sleep 1s
done
) > ttyUSB0

cleanup() {
    rm ttyUSB0
    echo "Removed fake device ttyUSB0"
}

cleanup
